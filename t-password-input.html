<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../t-input/t-input.html" />
<link rel="import" href="../t-checkbox/t-checkbox.html" />
<!--
`paper-tab` is styled to look like a tab.  It should be used in conjunction with
`paper-tabs`.

Example:

    <paper-tabs selected="0">
      <paper-tab>TAB 1</paper-tab>
      <paper-tab>TAB 2</paper-tab>
      <paper-tab>TAB 3</paper-tab>
    </paper-tabs>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--paper-tab-ink` | Ink color | `--paper-yellow-a100`
`--paper-tab` | Mixin applied to the tab | `{}`
`--paper-tab-content` | Mixin applied to the tab content | `{}`

-->
<dom-module id="t-password-input">
    <template>
        <style>
        p {
            margin: 0;
            padding-left: 15px;
            position: relative;
            color: var(--grey-three, #bbbbbb);
        }
        
        p::before {
            content: "•";
            position: absolute;
            left: 0;
        }
        
        .invalid {
            color: var(--error-color, #FF0000);
        }
        
        .invalid::before {
            content: "•";
        }
        
        .valid {
            color: var(--success-color, #7fad4d);
            padding-left: 15px;
        }
        
        .valid::before {
            content: "✔";
            left: 0;
            top: -2px;
        }
        /* .base, label {
            color: #bbbbbb;
        }
        
        .
        
        span, ul li {
            font-family: 'Open Sans', sans-serif;
            font-size: 12px;
        }
        
        ul {
            margin-left: -25px;
        }
        
        t-checkbox {
            margin-top: 15px;
        } */
        </style>
        <t-input id="password" type$="{{type}}" on-value-changed="_validateRegex" value="{{value::input}}" label="Password" required></t-input>
        <t-checkbox id="chkPassword" on-click="_togglePaswordVisibility">Show password</t-checkbox>
        <template is="dom-if" if="[[!noValidation]]">
            <template is="dom-repeat" items="{{defaultPasswordCheckList}}">
                <p class$="{{item.status}} || base">
                    {{item.message}}
                </p>
            </template>
        </template>
    </template>
    <script>
    Polymer({

        is: 't-password-input',

        properties: {

            value: {
                type: String,
                notify: true
            },

            noValidation: {
                type: Boolean,
                value: false
            },


            defaultPasswordCheckList: {
                type: Array,
                value: [{
                    isMatched: false,
                    message: 'One lower case character',
                    regex: new RegExp("[a-z]")
                }, {
                    isMatched: false,
                    message: 'One upper case character',
                    regex: new RegExp("[A-Z]")
                }, {
                    isMatched: false,
                    message: 'One number',
                    regex: new RegExp("[0-9]")
                }, {
                    isMatched: false,
                    message: 'One special character',
                    regex: new RegExp("[!@#$%^&*()_+=?]")
                }, {
                    isMatched: false,
                    message: '8 characters minimum',
                    regex: new RegExp(/^.{8,99}$/)
                }],
                readOnly: true
            }
        },

        attached: function() {
            this.type = 'password';
        },

        _validateRegex: function(e, data) {
            if (this.noValidation) {
                return;
            }
            this.defaultPasswordCheckList.forEach(function(item, index, array) {
                var statusProperty = 'defaultPasswordCheckList.' + index + '.status';
                var isMatchedProperty = 'defaultPasswordCheckList.' + index + '.isMatched';

                if (!data.value) {
                    this.set(statusProperty, 'base');
                } else if (data.value.match(item.regex)) {
                    this.set(statusProperty, 'valid');
                    this.set(isMatchedProperty, true);
                } else {
                    this.set(statusProperty, 'invalid');
                    this.set(isMatchedProperty, false);
                }
            }, this);
        },

        _togglePaswordVisibility: function(e) {
            this.type = this.$.chkPassword.checked ? 'text' : 'password';
        },

        _validPassword: function() {
            var isValid = true;
            for (var i = 0; i < this.defaultPasswordCheckList.length; i++) {
                isValid = this.defaultPasswordCheckList[i].isMatched && isValid;
            }
            return isValid;
        },

        validate: function() {
            return this.$.password.validate() && (this.noValidation || this._validPassword());
        },
    });
    </script>
</dom-module>
