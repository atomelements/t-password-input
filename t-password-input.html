<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../t-input/t-input.html" />
<link rel="import" href="../t-checkbox/t-checkbox.html" />
<link rel="import" href="../t-shared-components/theme.html">
<dom-module id="t-password-input">
    <template>
        <style>
	        .base {
	            color: #bbbbbb;
	        }
	        
	        .red {
	            color: red;
	        }
	        
	        .green {
	            color: green;
	        }
	        
	        span, ul li {
	            font-family: 'Open Sans', sans-serif;
	            font-size: 12px;
	        }
	        
	        label {
	            color: #bbbbbb;
	        }
	        
	        ul {
	            margin-left: -25px;
	        }

	        t-checkbox{
	        	margin-top: 15px;
	        }
        </style>
        <t-input id="password" type="{{type}}" value="{{password::input}}" label="Password" required></t-input>
        <t-checkbox id="chkPassword" on-click="_showPassword">Show password</t-checkbox>
        <ul>
            <template is="dom-repeat" items="{{PasswordCheckList}}">
                <li class$="{{item.status}}">
                    <span>{{item.message}}</span>
                </li>
            </template>
        </ul>
    </template>
    <script>
    Polymer({

        is: 't-password-input',

        properties: {

            password: {
                type: String,
                observer: '_checkPasswordStrength',
                notify:true
            },

            isValidPassword: {
                type: Boolean,
                notify: true
            },

            type: {
                type: String,
                value: 'password'
            },

            regex: {
                type: Object,
                value: {
                    numeric: new RegExp("[0-9]"),
                    specialCharacters: new RegExp("[!@#$%^&*()_+=?]"),
                    upperCase: new RegExp("[A-Z]"),
                    lowerCase: new RegExp("[a-z]")
                }
            },

            PasswordCheckList: {
                type: Array,
                value: [{
                    isSatisfied: false,
                    message: 'One lower case character',
                    status: 'base'
                }, {
                    isSatisfied: false,
                    message: 'One upper case character',
                    status: 'base'
                }, {
                    isSatisfied: false,
                    message: 'One number',
                    status: 'base'
                }, {
                    isSatisfied: false,
                    message: 'One special character',
                    status: 'base'
                }, {
                    isSatisfied: false,
                    message: '8 characters minimum',
                    status: 'base'
                }]
            }
        },

        _checkPasswordStrength: function(value) {
            this._checkAlphanumeric(value);
            this._checkSpecialCharacters(value);
            this._checkMaximumLength(value);
            this._checkUpperCase(value);
            this._checLowerkCase(value);
            this.isValidPassword = this.validate();
        },

        //password strength validator
        _checLowerkCase: function(value) {
            if (!value) {
                this.set('PasswordCheckList.0.status', 'base');
            } else if (value.match(this.regex.lowerCase)) {
                this.set('PasswordCheckList.0.status', 'green');
                this.set('PasswordCheckList.0.isSatisfied', true);
            } else {
                this.set('PasswordCheckList.0.status', 'red');
                this.set('PasswordCheckList.0.isSatisfied', false);
            }
        },

        _checkUpperCase: function(value) {
            if (!value) {
                this.set('PasswordCheckList.1.status', 'base');
            } else if (value.match(this.regex.upperCase)) {
                this.set('PasswordCheckList.1.status', 'green');
                this.set('PasswordCheckList.1.isSatisfied', true);
            } else {
                this.set('PasswordCheckList.1.status', 'red');
                this.set('PasswordCheckList.1.isSatisfied', false);
            }
        },

        _checkAlphanumeric: function(value) {
            if (!value) {
                this.set('PasswordCheckList.2.status', 'base');
            } else if (value.match(this.regex.numeric)) {
                this.set('PasswordCheckList.2.status', 'green');
                this.set('PasswordCheckList.2.isSatisfied', true);
            } else {
                this.set('PasswordCheckList.2.status', 'red');
                this.set('PasswordCheckList.2.isSatisfied', false);
            }
        },

        _checkSpecialCharacters: function(value) {
            if (!value) {
                this.set('PasswordCheckList.3.status', 'base');
            } else if (value.match(this.regex.specialCharacters)) {
                this.set('PasswordCheckList.3.status', 'green');
                this.set('PasswordCheckList.3.isSatisfied', true);
            } else {
                this.set('PasswordCheckList.3.status', 'red');
                this.set('PasswordCheckList.3.isSatisfied', false);
            }
        },

        _checkMaximumLength: function(value) {
            if (!value) {
                this.set('PasswordCheckList.4.status', 'base');
            } else if (value.length >= 8) {
                this.set('PasswordCheckList.4.status', 'green');
                this.set('PasswordCheckList.4.isSatisfied', true);
            } else {
                this.set('PasswordCheckList.4.status', 'red');
                this.set('PasswordCheckList.4.isSatisfied', false);
            }
        },
        //password strength validator ends

        _showPassword: function(e) {
            this.type = this.$.chkPassword.checked ? 'text' : 'password';
        },

        _validPassword: function() {
            var isValid = true;
            for (var i = 0; i < this.PasswordCheckList.length; i++) {
                isValid = this.PasswordCheckList[i].isSatisfied && isValid;
            }
            return isValid;
        },

        validate: function() {
            return this.$.password.validate() && this._validPassword();
        },
    });
    </script>
</dom-module>
